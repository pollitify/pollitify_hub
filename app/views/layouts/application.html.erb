<!DOCTYPE html>
<html>
  <head>
    <title><%= content_for(:title) || "#{BASE_PRODUCT_NAME} :: #{TAG_LINES.sample}" %></title>
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="turbo-prefetch" content="false">

    <%= csrf_meta_tags %>
    <%= csp_meta_tag %>

    <%= yield :head %>

    <%# Enable PWA manifest for installable apps (make sure to enable in config/routes.rb too!) %>
    <%= tag.link rel: "manifest", href: pwa_manifest_path(format: :json) %>

    <link rel="icon" href="/favicon.png" type="image/png">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/icon.svg" type="image/svg+xml">
    <link rel="apple-touch-icon" href="/favicon.png">

    <%# Includes all stylesheet files in app/assets/stylesheets %>
    <%= stylesheet_link_tag :app, "data-turbo-track": "reload" %>
    <%= javascript_importmap_tags %>
    
    <!-- app/views/layouts/application.html.erb in <head> -->
    <% if @event %>
    <meta property="og:title" content="<%= @event&.name || BASE_PRODUCT_NAME %>" />
    <meta property="og:description" content="<%= @event&.body.truncate(100) if @event && @event.body %>" />
    <meta property="og:url" content="<%= request.original_url %>" />
    <meta property="og:type" content="event" />
    <% if 3 == 4%>
    <meta property="og:image" content="<%= url_for(@event.image) if @event&.image.attached? %>" />
    <% end %>

    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="<%= @event&.name %>" />
    <meta name="twitter:description" content="<%= @event&.body.truncate(100) if @event.body %>" />
    <% if 3 ==4%>
    <meta name="twitter:image" content="<%= url_for(@event.image) if @event&.image.attached? %>" />
    <% end %>
    <% end %>
  </head>

  <body>
    <%= render 'layouts/nav' %>

    <div id='main' class='container py-4'>
      <%= render 'shared/breadcrumb' %>

      <%= render 'shared/flash_messages' %>

      <%= yield %>
      
      <% if cookies[:user_location].blank? && 3 == 4%>
      <%# if 2 == 2%>
        <div class="modal fade" id="locationModal" tabindex="-1" aria-labelledby="locationModalLabel" aria-hidden="true">
          <div class="modal-dialog">
            <div class="modal-content">
              <div class="modal-header">
                <h5 class="modal-title" id="locationModalLabel">Set Your Location</h5>
              </div>
              <div class="modal-body">
                <p>We think you're in 
                  <strong><%= @inferred_city || "your city" %>, <%= @inferred_state || "your state" %></strong>.
                  Please confirm or update:
                </p>
                <form id="locationForm">
                  <div class="mb-3">
                    <label class="form-label">City</label>
                    <input type="text" class="form-control" id="city" value="<%= @inferred_city %>">
                  </div>
                  <div class="mb-3">
                    <!-- <label class="form-label">State</label>
                    <input type="text" class="form-control" id="state" value="<%= @inferred_state %>"> -->
                      
                      <label for="state">State</label>
                      <select id="state" name="state">
                        <option value="" disabled selected>Select a state</option>
                        <option value="AL">Alabama</option>
                        <option value="AK">Alaska</option>
                        <option value="AZ">Arizona</option>
                        <option value="AR">Arkansas</option>
                        <option value="CA">California</option>
                        <option value="CO">Colorado</option>
                        <option value="CT">Connecticut</option>
                        <option value="DE">Delaware</option>
                        <option value="FL">Florida</option>
                        <option value="GA">Georgia</option>
                        <option value="HI">Hawaii</option>
                        <option value="ID">Idaho</option>
                        <option value="IL">Illinois</option>
                        <option value="IN">Indiana</option>
                        <option value="IA">Iowa</option>
                        <option value="KS">Kansas</option>
                        <option value="KY">Kentucky</option>
                        <option value="LA">Louisiana</option>
                        <option value="ME">Maine</option>
                        <option value="MD">Maryland</option>
                        <option value="MA">Massachusetts</option>
                        <option value="MI">Michigan</option>
                        <option value="MN">Minnesota</option>
                        <option value="MS">Mississippi</option>
                        <option value="MO">Missouri</option>
                        <option value="MT">Montana</option>
                        <option value="NE">Nebraska</option>
                        <option value="NV">Nevada</option>
                        <option value="NH">New Hampshire</option>
                        <option value="NJ">New Jersey</option>
                        <option value="NM">New Mexico</option>
                        <option value="NY">New York</option>
                        <option value="NC">North Carolina</option>
                        <option value="ND">North Dakota</option>
                        <option value="OH">Ohio</option>
                        <option value="OK">Oklahoma</option>
                        <option value="OR">Oregon</option>
                        <option value="PA">Pennsylvania</option>
                        <option value="RI">Rhode Island</option>
                        <option value="SC">South Carolina</option>
                        <option value="SD">South Dakota</option>
                        <option value="TN">Tennessee</option>
                        <option value="TX">Texas</option>
                        <option value="UT">Utah</option>
                        <option value="VT">Vermont</option>
                        <option value="VA">Virginia</option>
                        <option value="DC">Washington, DC</option>
                        <option value="WA">Washington</option>
                        <option value="WV">West Virginia</option>
                        <option value="WI">Wisconsin</option>
                        <option value="WY">Wyoming</option>
                      </select>
                      
                      
                  </div>
                  <button type="submit" class="btn btn-primary">Save Location</button>
                </form>
              </div>
            </div>
          </div>
        </div>

        <script>
          document.addEventListener("DOMContentLoaded", function() {
            var locationModal = new bootstrap.Modal(document.getElementById('locationModal'));
            locationModal.show();

            document.getElementById("locationForm").addEventListener("submit", function(e) {
              e.preventDefault();
              var city = document.getElementById("city").value;
              var state = document.getElementById("state").value;

              fetch("<%= set_location_path %>", {
                method: "POST",
                headers: {
                  "Content-Type": "application/json",
                  "X-CSRF-Token": document.querySelector("meta[name='csrf-token']").content
                },
                body: JSON.stringify({ city: city, state: state })
              }).then(() => {
                locationModal.hide();
                location.reload();
              });
            });
          });
        </script>
      <% end %>
      
    </div>
    <%= render 'layouts/footer'%>
  </body>
</html>
